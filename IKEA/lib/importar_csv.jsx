#target indesign#include "~/_scripts/frameworks/Extendables/extendables.jsx"function loadDataFromFile(fileName, sepBy) {    var sep = sepBy ? sepBy : ";";        var file = File(fileName);    file.open("r");        var data = [];    while (! file.eof ) {        var line = file.readln().split(sep);        var item = [];        for (var i=0; i<line.length; ++i)             item.push(line[i]);        data.push( item );    }        file.close();        return data;}function saveDataToFile(fileName, data, sepBy) {    var sep = sepBy ? sepBy : ";";        var file = File(fileName);    file.open("w");    data.forEach( function(cp) {        if (cp)            file.writeln(cp.join(sep));    } );    file.close();}function mkObject(arr, item_i) {    var Obj = {};    var i = item_i ? item_i : 0;        arr.forEach( function(row) { Obj[ row[i] ] = row; } );    return Obj;}var codigo_precio_nuevo = loadDataFromFile(File.openDialog ("Fichero de precios nuevos"));var codigo_precio_ref   = mkObject(loadDataFromFile(File.openDialog ("Fichero de precios referencia")));var codigo_precio = codigo_precio_nuevo.map( function(cp) {    var code = cp[0];    var ref = codigo_precio_ref[code];    if (ref) {        var precio_ref   = ref[1].indexOf('.') >= 0 ? ref[1] : ref[1] + '.00';        var precio_nuevo = cp[1].indexOf('.') >= 0 ? cp[1] : cp[1] + '.00';                return [ code, precio_ref, precio_nuevo ];     }});codigo_precio_nuevo = null;codigo_precio_ref = null;saveDataToFile(File.saveDialog ("Fichero destino"), codigo_precio);codigo_precio = null;