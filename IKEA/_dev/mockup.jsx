#target indesign#strict on#include "~/_scripts/frameworks/Extendables/extendables.jsx"#include "~/_scripts/frameworks/Underscore/LoDash.jsx"#include "Lib_IKEAProducts.jsx"#include "Lib_UI.jsx"var ui = require("ui")var json_str = [{"partNumber":"59874387","almcod":"CACH","formatNumber":"598.743.87","dataPrint":"140116","name":"IKEA PS L\u00d6V\u00c5S","facts":"Sof\u00e1-cama 2 plazas","color":" Vansta rojo","size":"163x111x86 cm","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/598743870108339_PE258085_S3.JPG","assembly":"S\u00ed","priceNormal":"369\u20ac","priceSale":"0\u20ac","priceOriginal":"369\u20ac","currency":"\u20ac","package":null,"designer":"IKEA of Sweden\/T Sandell\/C Martin","area":"113","quantity":null,"custMaterials":{"0":"Estructura sof\u00e1 cama 2 plazas: ","2":"Acero, Acero, Revestimiento epoxi\/poli\u00e9ster en polvo.","4":"Pl\u00e1stico de polipropileno., Caucho sint\u00e9tico","5":"Colch\u00f3n: ","7":"Poliuretano 28 kg\/m3","9":"Guata de poli\u00e9ster, Tela de fibras de polipropileno.","11":"79% algod\u00f3n, 21% poli\u00e9ster","12":"Funda para sof\u00e1 cama 2 plazas: ","14":"100% algod\u00f3n","16":"Guata de poli\u00e9ster","18":"Fibras de poli\u00e9ster"},"goodToKnow":["Puede completarse con el caj\u00f3n de almacenaje para el sof\u00e1 cama de 2 plazas IKEA PS."],"measure":{"Ancho":"163 cm","fondo":"111 cm","Altura":"86 cm","profundidad del asiento":"50 cm","altura del asiento":"41 cm","ancho de cama":"160 cm","largo de cama":"205 cm"},"pkgmeas":[],"careInst":["Colch\u00f3n: ","No se debe lavar a m\u00e1quina.","No utilizar lej\u00eda.","No utilizar lej\u00eda.","No secar en secadora.","No secar en secadora.","Planchar a temperatura media.","Limpiar en seco.","Limpiar en seco.","Secar colgado.","Funda para sof\u00e1 cama 2 plazas: ","Funda: ","Lavar a m\u00e1quina a 40\u00b0C.","Lavar aparte.","No utilizar lej\u00eda.","No utilizar lej\u00eda.","No secar en secadora.","No secar en secadora.","Planchar a temperatura alta.","Limpiar en seco.","Limpiar en seco."],"custBenefit":["Debido a sus ruedas, es f\u00e1cil desplazar el sof\u00e1 para limpiar o cambiar los muebles de sitio.","Se convierte f\u00e1cilmente en una amplia cama para dos.","Cambia y renueva la decoraci\u00f3n con las fundas extra.","Escoge entre tres colchones diferentes y una amplia gama de fundas para crear tu combinaci\u00f3n ideal.","Un sencillo colch\u00f3n firme de espuma de poliuretano para usar a diario.","F\u00e1cil de mantener. Funda de colch\u00f3n f\u00e1cil de quitar y lavable."],"subitemQuantity":0,"subitems":[{"partNumber":"50178736","almcod":"KGJ","formatNumber":"501.787.36","dataPrint":"140116","name":"IKEA PS","facts":"Estructura sof\u00e1 cama 2 plazas","color":" blanco","size":"163x100x86 cm","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/5017873607107_S3.jpg","assembly":"S\u00ed","priceNormal":"150\u20ac","priceSale":"0\u20ac","priceOriginal":"150\u20ac","currency":"\u20ac","package":"1","designer":"T Sandell\/C Martin","area":"0121","quantity":1,"custMaterials":{"Estructura de columna:":"Acero, Acero, Revestimiento epoxi\/poli\u00e9ster en polvo.","Rueda\/ Pie:":"Pl\u00e1stico de polipropileno., Caucho sint\u00e9tico"},"goodToKnow":["Puede completarse con el caj\u00f3n de almacenaje para el sof\u00e1 cama de 2 plazas IKEA PS."],"measure":{"Ancho":"163 cm","fondo":"100 cm","Altura":"86 cm","profundidad del asiento":"50 cm","altura del asiento":"41 cm","ancho de cama":"160 cm","largo de cama":"205 cm"},"pkgmeas":[],"careInst":null,"custBenefit":["Debido a sus ruedas, es f\u00e1cil desplazar el sof\u00e1 para limpiar o cambiar los muebles de sitio.","Se convierte f\u00e1cilmente en una amplia cama para dos.","Cambia y renueva la decoraci\u00f3n con las fundas extra.","Escoge entre tres colchones diferentes y una amplia gama de fundas para crear tu combinaci\u00f3n ideal."],"subitemQuantity":"1","subitems":[]},{"partNumber":"10102649","almcod":"FFO","formatNumber":"101.026.49","dataPrint":"140116","name":"IKEA PS L\u00d6V\u00c5S","facts":"Colch\u00f3n","color":"","size":"","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/1010264964402_PE174959_S3.jpg","assembly":"No","priceNormal":"100\u20ac","priceSale":"0\u20ac","priceOriginal":"100\u20ac","currency":"\u20ac","package":"1","designer":"T Sandell\/C Martin","area":"0121","quantity":1,"custMaterials":{"Componente 01:":"Poliuretano 28 kg\/m3","Guateado:":"Guata de poli\u00e9ster, Tela de fibras de polipropileno.","Cut\u00ed:":"79% algod\u00f3n, 21% poli\u00e9ster"},"goodToKnow":null,"measure":{"Largo del colch\u00f3n":"205 cm","Ancho del colch\u00f3n":"160 cm","grosor del colch\u00f3n":"10 cm"},"pkgmeas":[],"careInst":["No se debe lavar a m\u00e1quina.","No utilizar lej\u00eda.","No secar en secadora.","Planchar a temperatura media.","Limpiar en seco.","Secar colgado."],"custBenefit":["Un sencillo colch\u00f3n firme de espuma de poliuretano para usar a diario.","F\u00e1cil de mantener. Funda de colch\u00f3n f\u00e1cil de quitar y lavable."],"subitemQuantity":"1","subitems":[]},{"partNumber":"20184814","almcod":"KAN","formatNumber":"201.848.14","dataPrint":"140116","name":"IKEA PS","facts":"Funda para sof\u00e1 cama 2 plazas rojo","color":" Vansta rojo","size":"","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/201848140108339_PE258085_S3.JPG","assembly":"S\u00ed","priceNormal":"119\u20ac","priceSale":"0\u20ac","priceOriginal":"119\u20ac","currency":"\u20ac","package":"1","designer":"IKEA of Sweden","area":"0121","quantity":1,"custMaterials":{"Composici\u00f3n total:":"100% algod\u00f3n","Guateado:":"Guata de poli\u00e9ster","Coj\u00edn suelto:":"Fibras de poli\u00e9ster"},"goodToKnow":null,"measure":[],"pkgmeas":[],"careInst":["Funda: ","Lavar a m\u00e1quina a 40\u00b0C.","Lavar aparte.","No utilizar lej\u00eda.","No secar en secadora.","Planchar a temperatura alta.","Limpiar en seco."],"custBenefit":[],"subitemQuantity":"1","subitems":[]}]}];var product = IKEA.ProductJSON(json_str);function show_article(partNumber, product) {    if (!partNumber && !product) {        throw IKEA.build_error(ValidationError,                 'No se ha indicado ningún código de producto en linea ' + $.line              );    }    if (!product) {        product = IKEA.Product(partNumber);    }    var wnd = createProductWindow(800, 600, 'Producto con ref. ' + product.get('formatNumber'))              .assignProduct(product)              .show();}function assignProductWindow(wnd, product) {}function createProductWindow(width, height, title) {    var defWin = app.windows.length > 0 ? app.activeWindow : { bounds: [0, 0, 800, 600] };    var mixins = {        'mainWindow': { 'preferredSize': centerRelativeTo(defWin, width, height),                        'alignChildren':'left',                        'alignment':'fill',                      },        'button': { 'preferredSize': [120, 24],  },        'nospc': { 'spacing':0 },        'panelStyle': { 'alignment':['left', 'fill'], 'alignChildren':'left' },        'stacked': { 'orientation': 'stack' },        'edit_0': { 'size':[30, 24], },        'edit_1': { 'size':[50, 24], },        'edit_2': { 'size':[90, 24], },        'edit_3': { 'size':[110, 24], },        'edit_4': { 'size':[150, 24], },        'edit_5': { 'size':[200, 24], },        'edit_6': { 'size':[339, 24], },        'edit_7': { 'size':[608, 24], },        'blkl': { size:[440, 130] },        'blkr': { size:[245, 130] },        'row_3':  { alignment: ['fill','fill' ], size:[440, 30], },        'col_r': { alignment: ['fill','fill' ], alignChildren:'top', size:[245, 200], },        'col_l': { size:[440, 200] },        'third': { size:[width-50, height/3-80] },        'lefty': { alignChildren:'left' },    };    var _n = function(key) { return IKEA[key]; };    var _l = function(key) { return IKEA.labels[IKEA[key]]; };    /* structure */    var wnd = ext_UI(new ui.Dialog(title).with(mixins));        wnd.structure = {};        // shotcut for label + input with the product    wnd.constructor.prototype.l_input = function(key) {         return this.input_labeled(_l(key), _n(key));    }    // shotcut for label + multi_input with the product    wnd.constructor.prototype.l_multinput = function(key) {         return this.input_multi(_l(key), _n(key));    }    // Create Tab + TabPanels    var tabLabels = ['Artículo', 'Más información', 'Componentes'];    var control_panels = function(label) {        tabArticle.window.visible = label == tabLabels[0];        tabInfo.window.visible = label == tabLabels[1];        tabSubs.window.visible = label == tabLabels[2];    }    wnd.column('main').using('mainWindow').tabbedPanel(tabLabels, control_panels);    wnd.activeTabText = 'Artículo';           // Builds the widget for the main product information    wnd.constructor.prototype.productDetaill = function() {         this.row('r1')            .l_input('CF_FORMATNUMBER').using('edit_2')            .l_input('CF_ALMCOD').using('edit_1')            .l_input('CF_NAME').using('edit_6');                        this.row('r2')            .l_input('CF_FACTS').using('edit_7');                        this.row('r3').column('c1').using('blkl').row('r1').using('row_3')            .l_input('CF_COLOR').using('edit_5')            .l_input('CF_SIZE').using('edit_3');                        this.r3.c1.row('r2').using('row_3')            .l_input('CF_PRICENORMAL').using('edit_1')            .l_input('CF_PRICEORIGINAL').using('edit_1')            .l_input('CF_PRICESALE').using('edit_1');                        this.r3.c1.row('r3').using('row_3')            .l_input('CF_ASSEMBLY').using('edit_0')            .l_input('CF_CURRENCY').using('edit_0')            .l_input('CF_PACKAGE').using('edit_2');                        this.r3.c1.row('r4').using('row_3')            .l_input('CF_DESIGNER').using('edit_6');                        this.r3.column('c2').using('panelStyle').stack('s1')                .panel('imgbg').using('blkr')                .image('img', '~/Sin título.png').using('blkr'); // TODO: load image                            return this;    };    wnd.main.column('tabContainer').using('stacked');        /** Tab "Artículo" */    var tabArticle = wnd.main.tabContainer.panel('particle').using('panelStyle');    tabArticle.productDetaill(true);    tabArticle.row('r4').column('c1')        .l_multinput('CF_CUSTMATERIALS').using('col_l');        tabArticle.r4.column('c2').using('col_r')        .l_multinput('CF_MEASURE').using('col_r');                        /** Tab "Información" */    var tabInfo = wnd.main.tabContainer.panel('pinfo').using('panelStyle');    tabInfo.column('c1')        .l_multinput('CF_GOODTOKNOW').using('third')        .l_multinput('CF_CAREINST').using('third')        .l_multinput('CF_CUSTBENEFIT').using('third');                        /** Tab "Información" */    var tabSubs = wnd.main.tabContainer.panel('psubs').using('panelStyle');    tabSubs.column('c1').using('lefty')        .text('lb_subs', 'Compuesto por')        .list(IKEA.CF_SUBITEMS, ['Cod. Subartículo', 'Cod. Corto', 'Artículo']).using("third");    tabSubs.c1        .text('lb_resumen', 'Resumen de características del subartículo seleccionado')        .panel('p1')            .productDetaill(false);        tabArticle.window.visible = true;    tabInfo.window.visible = false;    tabSubs.window.visible =  false;            /** Buttons */            wnd.main.row('buttons').button('accept', 'Aceptar').button('cancel', 'Cerrar');        wnd.window.cancelElement = wnd.main.buttons.cancel;    wnd.main.buttons.accept.on('click').do(function() { this.window.close(); });    wnd.main.buttons.cancel.on('click').do(function() { this.window.close(); });        wnd.window.layout.layout(1);    /** Members */    wnd.window.cancelElement = wnd.main.buttons.cancel;        wnd.main.buttons.accept.on('click').do(function() { this.window.close(); });    wnd.main.buttons.cancel.on('click').do(function() { this.window.close(); });        wnd.assignProduct = function(product) {        var _a = function(key) {            var w = wnd.find(key);            var d = product.get(key);            if (w && d) {                if (d.is(Array))                    w.text = d.join('\n');                else if (d.is(String))                    w.text = d;                else                     w.text = _join(d);            }        };            var _join = function(key) {            var res = [];            _.forOwn(key, function(item, key) {                // If key is a number, don't add to the string                // _.isNumber not working!!! Don't know why.                if (key === String(Number(key))) {                    res.push(item);                } else {                    res.push(key + ': '+ item);                }            });            return res.join('\r');        };        for (prop in IKEA) {            if (prop.slice(0,3) === 'CF_') {                _a(IKEA[prop]);            }        }        // Treat special case for subitems        var subs = product.get(IKEA.CF_SUBITEMS);        return wnd;    };    wnd.show = function() {        wnd.window.show();        return wnd;    };        return wnd;}show_article(undefined, product);