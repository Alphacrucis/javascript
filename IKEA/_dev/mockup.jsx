#target indesign#strict on#include "~/_scripts/frameworks/Extendables/extendables.jsx"#include "~/_scripts/frameworks/Underscore/LoDash.jsx"#include "Lib_IKEAProducts.jsx"var ui = require("ui");var json_str = [{"partNumber":"59874387","almcod":"CACH","formatNumber":"598.743.87","dataPrint":"140116","name":"IKEA PS L\u00d6V\u00c5S","facts":"Sof\u00e1-cama 2 plazas","color":" Vansta rojo","size":"163x111x86 cm","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/598743870108339_PE258085_S3.JPG","assembly":"S\u00ed","priceNormal":"369\u20ac","priceSale":"0\u20ac","priceOriginal":"369\u20ac","currency":"\u20ac","package":null,"designer":"IKEA of Sweden\/T Sandell\/C Martin","area":"113","quantity":null,"custMaterials":{"0":"Estructura sof\u00e1 cama 2 plazas: ","2":"Acero, Acero, Revestimiento epoxi\/poli\u00e9ster en polvo.","4":"Pl\u00e1stico de polipropileno., Caucho sint\u00e9tico","5":"Colch\u00f3n: ","7":"Poliuretano 28 kg\/m3","9":"Guata de poli\u00e9ster, Tela de fibras de polipropileno.","11":"79% algod\u00f3n, 21% poli\u00e9ster","12":"Funda para sof\u00e1 cama 2 plazas: ","14":"100% algod\u00f3n","16":"Guata de poli\u00e9ster","18":"Fibras de poli\u00e9ster"},"goodToKnow":["Puede completarse con el caj\u00f3n de almacenaje para el sof\u00e1 cama de 2 plazas IKEA PS."],"measure":{"Ancho":"163 cm","fondo":"111 cm","Altura":"86 cm","profundidad del asiento":"50 cm","altura del asiento":"41 cm","ancho de cama":"160 cm","largo de cama":"205 cm"},"pkgmeas":[],"careInst":["Colch\u00f3n: ","No se debe lavar a m\u00e1quina.","No utilizar lej\u00eda.","No utilizar lej\u00eda.","No secar en secadora.","No secar en secadora.","Planchar a temperatura media.","Limpiar en seco.","Limpiar en seco.","Secar colgado.","Funda para sof\u00e1 cama 2 plazas: ","Funda: ","Lavar a m\u00e1quina a 40\u00b0C.","Lavar aparte.","No utilizar lej\u00eda.","No utilizar lej\u00eda.","No secar en secadora.","No secar en secadora.","Planchar a temperatura alta.","Limpiar en seco.","Limpiar en seco."],"custBenefit":["Debido a sus ruedas, es f\u00e1cil desplazar el sof\u00e1 para limpiar o cambiar los muebles de sitio.","Se convierte f\u00e1cilmente en una amplia cama para dos.","Cambia y renueva la decoraci\u00f3n con las fundas extra.","Escoge entre tres colchones diferentes y una amplia gama de fundas para crear tu combinaci\u00f3n ideal.","Un sencillo colch\u00f3n firme de espuma de poliuretano para usar a diario.","F\u00e1cil de mantener. Funda de colch\u00f3n f\u00e1cil de quitar y lavable."],"subitemQuantity":0,"subitems":[{"partNumber":"50178736","almcod":"KGJ","formatNumber":"501.787.36","dataPrint":"140116","name":"IKEA PS","facts":"Estructura sof\u00e1 cama 2 plazas","color":" blanco","size":"163x100x86 cm","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/5017873607107_S3.jpg","assembly":"S\u00ed","priceNormal":"150\u20ac","priceSale":"0\u20ac","priceOriginal":"150\u20ac","currency":"\u20ac","package":"1","designer":"T Sandell\/C Martin","area":"0121","quantity":1,"custMaterials":{"Estructura de columna:":"Acero, Acero, Revestimiento epoxi\/poli\u00e9ster en polvo.","Rueda\/ Pie:":"Pl\u00e1stico de polipropileno., Caucho sint\u00e9tico"},"goodToKnow":["Puede completarse con el caj\u00f3n de almacenaje para el sof\u00e1 cama de 2 plazas IKEA PS."],"measure":{"Ancho":"163 cm","fondo":"100 cm","Altura":"86 cm","profundidad del asiento":"50 cm","altura del asiento":"41 cm","ancho de cama":"160 cm","largo de cama":"205 cm"},"pkgmeas":[],"careInst":null,"custBenefit":["Debido a sus ruedas, es f\u00e1cil desplazar el sof\u00e1 para limpiar o cambiar los muebles de sitio.","Se convierte f\u00e1cilmente en una amplia cama para dos.","Cambia y renueva la decoraci\u00f3n con las fundas extra.","Escoge entre tres colchones diferentes y una amplia gama de fundas para crear tu combinaci\u00f3n ideal."],"subitemQuantity":"1","subitems":[]},{"partNumber":"10102649","almcod":"FFO","formatNumber":"101.026.49","dataPrint":"140116","name":"IKEA PS L\u00d6V\u00c5S","facts":"Colch\u00f3n","color":"","size":"","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/1010264964402_PE174959_S3.jpg","assembly":"No","priceNormal":"100\u20ac","priceSale":"0\u20ac","priceOriginal":"100\u20ac","currency":"\u20ac","package":"1","designer":"T Sandell\/C Martin","area":"0121","quantity":1,"custMaterials":{"Componente 01:":"Poliuretano 28 kg\/m3","Guateado:":"Guata de poli\u00e9ster, Tela de fibras de polipropileno.","Cut\u00ed:":"79% algod\u00f3n, 21% poli\u00e9ster"},"goodToKnow":null,"measure":{"Largo del colch\u00f3n":"205 cm","Ancho del colch\u00f3n":"160 cm","grosor del colch\u00f3n":"10 cm"},"pkgmeas":[],"careInst":["No se debe lavar a m\u00e1quina.","No utilizar lej\u00eda.","No secar en secadora.","Planchar a temperatura media.","Limpiar en seco.","Secar colgado."],"custBenefit":["Un sencillo colch\u00f3n firme de espuma de poliuretano para usar a diario.","F\u00e1cil de mantener. Funda de colch\u00f3n f\u00e1cil de quitar y lavable."],"subitemQuantity":"1","subitems":[]},{"partNumber":"20184814","almcod":"KAN","formatNumber":"201.848.14","dataPrint":"140116","name":"IKEA PS","facts":"Funda para sof\u00e1 cama 2 plazas rojo","color":" Vansta rojo","size":"","environment":[],"island":"tenerife","itemquantity":null,"image":"https:\/\/s3-eu-west-1.amazonaws.com\/ikeasiwebimages\/imagenes_articulosweb\/201848140108339_PE258085_S3.JPG","assembly":"S\u00ed","priceNormal":"119\u20ac","priceSale":"0\u20ac","priceOriginal":"119\u20ac","currency":"\u20ac","package":"1","designer":"IKEA of Sweden","area":"0121","quantity":1,"custMaterials":{"Composici\u00f3n total:":"100% algod\u00f3n","Guateado:":"Guata de poli\u00e9ster","Coj\u00edn suelto:":"Fibras de poli\u00e9ster"},"goodToKnow":null,"measure":[],"pkgmeas":[],"careInst":["Funda: ","Lavar a m\u00e1quina a 40\u00b0C.","Lavar aparte.","No utilizar lej\u00eda.","No secar en secadora.","Planchar a temperatura alta.","Limpiar en seco."],"custBenefit":[],"subitemQuantity":"1","subitems":[]}]}];var product = IKEA.ProductJSON(json_str);function centerRelativeTo(window, width, height) {    /** Return an array with the Bounds of a window of         size (width, height) center in the bound suministrate.        Be careful, Indesign window bounds are [y0,x0,y1,x1]        while ScriptUI bounds are [x0, y0, x1, y1]    */    var swap = function(b) { return { x0:b[1], y0:b[0], x1:b[3], y1:b[2] }; } // fix the reversed coord.    var wb =  swap(window.bounds);     var y0 = (wb.y1 + wb.y0 - height) / 2;    var x0 = (wb.x1 + wb.x0 - width) / 2    return [x0, y0, x0+width, y0+height];    //return [bound[1], bound[0], bound[3], bound[2]];}function show_article(partNumber, product) {    if (!partNumber && !product) {        throw IKEA.build_error(ValidationError,                 'No se ha indicado ningún código de producto en linea ' + $.line              );    }    if (!product) {        product = IKEA.Product(partNumber);    }    var wnd = createWindow(800, 600, 'Producto con ref. ' + product.get('formatNumber'), product);    wnd.window.show();}function assign(wnd, product) {    wnd.main.particle.r1.formatNumber.text = product.get('formatNumber');    wnd.main.particle.r1.almcod.text = product.get('almcod');    wnd.main.particle.r1.name.text = product.get('name');    wnd.main.particle.r2.facts.text = product.get('facts');    wnd.main.particle.r3.c1.r1.color.text = product.get('color');    return wnd;}function createWindow(width, height, title, product) {    var mixins = {        'mainWindow': { 'preferredSize': centerRelativeTo(app.activeWindow, width, height),                        'alignChildren':'left',                        'alignment':'fill',                      },        'button': { 'preferredSize': [120, 24],  },        'paletteStyle': { 'spacing':-10, },        'panelStyle': { 'alignment':['fill', 'fill'], alignChildren:'left' },        'paletteButton': { 'preferredSize': [120, 24], },        'edit_0': { 'size':[30, 24], },        'edit_1': { 'size':[50, 24], },        'edit_2': { 'size':[90, 24], },        'edit_3': { 'size':[110, 24], },        'edit_4': { 'size':[150, 24], },        'edit_5': { 'size':[200, 24], },        'edit_6': { 'size':[339, 24], },        'edit_7': { 'size':[608, 24], },        'blkl': { size:[440, 130] },        'blkr': { size:[245, 130] },        'row_3':  { alignment: ['fill','fill' ], size:[440, 30], },        'col_r': { alignment: ['fill','fill' ], alignChildren:'top', size:[245, 200], },        'multiedit': { size:[440, 200] },    };    var _q = function(key) { return product && product.get(IKEA[key]) || ''; };    var _l = function(key) { return IKEA.labels[IKEA[key]]; };        /* structure */    wnd = new ui.Dialog(title).with(mixins);        // extends UI prototype to add control [label + input]    wnd.constructor.prototype.labeled_input = function(key, style) {         if (style)            return this.text('lb_'+_l(key), _l(key)).input(IKEA[key], _q(key)).using(style);        else            return this.text('lb_'+_l(key), _l(key)).input(IKEA[key], _q(key));    }        wnd.column('main').using('mainWindow')        .row('palette').using('paletteStyle')            .button('article', 'Artículo').using('paletteButton')            .button('info', 'Más información').using('paletteButton')            .button('subitems', 'Componentes').using('paletteButton');    wnd.main.panel('particle').using('panelStyle').row('r1')            .labeled_input('CF_FORMATNUMBER', 'edit_2')            .labeled_input('CF_ALMCOD', 'edit_1')            .labeled_input('CF_NAME', 'edit_6');                wnd.main.particle.row('r2').labeled_input('CF_FACTS', 'edit_7');                wnd.main.particle.row('r3').column('c1').using('blkl').row('r1').using('row_3')            .labeled_input('CF_COLOR', 'edit_5')            .labeled_input('CF_SIZE', 'edit_3');                wnd.main.particle.r3.c1.row('r2').using('row_3')            .labeled_input('CF_PRICENORMAL', 'edit_1')            .labeled_input('CF_PRICEORIGINAL', 'edit_1')            .labeled_input('CF_PRICESALE', 'edit_1');                wnd.main.particle.r3.c1.row('r3').using('row_3')            .labeled_input('CF_ASSEMBLY', 'edit_0')            .labeled_input('CF_CURRENCY', 'edit_0')            .labeled_input('CF_PACKAGE', 'edit_2');                wnd.main.particle.r3.c1.row('r4').using('row_3')            .labeled_input('CF_DESIGNER', 'edit_6');                wnd.main.particle.r3.column('c2').using('panelStyle').stack('s1')            .panel('imgbg').using('blkr')            .image('img', '~/Sin título.png').using('blkr'); // TODO: load image    var _join = function(key) {        var cm = [];        var cmo = _q(key);        _.forOwn(cmo, function(item, key) {            // If key is a number, don't add to the string            // _.isNumber not working!!! NiP            if (key === String(Number(key))) {                cm.push(item);            } else {                cm.push(key + ': '+ item);            }        });            return cm.join('\r');    };    wnd.main.particle.row('r4').column('c1')            .text('lb'+_l('CF_CUSTMATERIALS'), _l('CF_CUSTMATERIALS'))            .add_control(_q('CF_CUSTMATERIALS'), 'edittext', _join('CF_CUSTMATERIALS'),                     { 'multiline':true } ).using('multiedit');        wnd.main.particle.r4.column('c2').using('col_r')            .text('lb'+_l('CF_MEASURE'), _l('CF_MEASURE'))            .add_control(_q('CF_MEASURE'), 'edittext', _join('CF_MEASURE'),                     { 'multiline':true } ).using('col_r');                        var obj = wnd.main.particle.r3.c2.s1.imgbg;    var v = obj.onDraw;    obj.onDraw = function(ds) {        var brush = this.graphics.newBrush(this.graphics.BrushType.SOLID_COLOR, [1,1,1]);        this.graphics.fillPath(brush, this.graphics.currentPath);    };    wnd.main.row('buttons')            .button('accept', 'Aceptar')            .button('cancel', 'Cerrar');        wnd.window.cancelElement = wnd.main.buttons.cancel;        wnd.main.buttons.accept.on('click').do(function() { this.window.close(); });    wnd.main.buttons.cancel.on('click').do(function() { this.window.close(); });        return wnd;}show_article(undefined, product);