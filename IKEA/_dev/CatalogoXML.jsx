/** IKEA Catalogo XML    Author: Javier Ramos            */#target "indesign"#targetengine "medianis"#strict on#include "~/_scripts/frameworks/Extendables/extendables.jsx"#include "lib/IKEA.jsx"// * --------------------------------------------------------------------------------------------------------function main() {    var w = main_ui().show();}function add_product(code, source) {    try {        var product = new IKEA.Product(code, IKEA.getSource(source));    } catch(e) {         alert("ValidationError: no hay datos para el código de artículo '" + code + "'");        return ;    }        if (product.isValid) {        var target, deletetarget = false;        if (!app.selection || app.selection.length === 0) {            deletetarget = true;            target = app.activeWindow.activePage.textFrames.add({ geometricBounds:[0,0,30,210] });        } else {            target = app.selection[0];        }        try {            IKEA.XML.productToXML(product, target);            IKEA.Styles.apply(target);        } catch(e) { alert(e.message); if (deletetarget) { target.remove(); } }    } else {        throwE(ValidationError, 'No se ha podido encontrar un artículo válido para la referencia: ' + code);    }}function view_product(code, source) {    try {        var product = new IKEA.Product(code, IKEA.getSource(source));    } catch(e) {         alert("ValidationError: no hay datos para el código de artículo '" + code + "'");        return ;    }        if (product.isValid) {        try {            show_product(product);        } catch(e) { alert(e.message); }     }}function main_ui() {    var buttonStyle = 'preferredSize: [120, 24]';    var wr = """palette {         alignChildren: 'fill',        source: DropDownList {},        codePanel: Panel {            enabled: false,            lb1: StaticText { text: 'Código Artículo' },            partNumber: EditText { preferredSize: [ 120,24 ]},            bInsert : Button { text: 'Insertar', #buttonStyle# },            bView : Button { text: 'Ver artículo', #buttonStyle# },        },        doAllPanel: Panel {            enabled: false,            lb1: StaticText { text: 'Aplicar a todo' },            bAllPage    : Button { text: 'Página', #buttonStyle# },            bAllSpread  : Button { text: 'Spread', #buttonStyle# },            bAllDocument: Button { text: 'Documento', #buttonStyle# },        },        bClose : Button { text:'Cerrar', #buttonStyle# }    }""".replace(/#buttonStyle#/g, buttonStyle);        var wnd = new Window(wr);    IKEA.ORIGENES.forEach(function(source) {        wnd.source.add('item', source.name);    });    wnd.activePanels = function() {        var enabled = wnd.source.selection.text !== '';        wnd.codePanel.enabled = enabled;        wnd.doAllPanel.enabled = enabled;    };    wnd.source.onChange = function() { wnd.activePanels(); };        wnd.cancelElement = wnd.bClose;        wnd.codePanel.bInsert.onClick = function() {         if (!!wnd.codePanel.partNumber.text) {            add_product(wnd.codePanel.partNumber.text, wnd.source.selection.text);        }    };        wnd.codePanel.bView.onClick = function() {        if (!!wnd.codePanel.partNumber.text) {            view_product(wnd.codePanel.partNumber.text, wnd.source.selection.text);        }    };        return wnd;}main();