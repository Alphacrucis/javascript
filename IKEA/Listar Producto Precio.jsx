#target "indesign"#targetengine "medianis"#strict on// http://extendables.org/#include "~/_scripts/frameworks/Extendables/extendables.jsx"#include "~/_scripts/lib/timer.jsx"#include "~/_scripts/lib/indesign.jsx"#include "lib/IKEA.jsx"var DEBUG=true;function listarProductoPrecio(doc, re, reC){    var pairsPC = [];    // genera pairsPC: pares de objetos Word (codigo,precio)    doc.allPageItems.filter( function(pi) { return pi instanceof TextFrame && re.test(pi.contents); } )                    .forEach( function(tFrame) {                        IKEA.removeLabelMarks(tFrame);                                                var w;                        var precio=null, codigo=null;                        var reP = /\$\d/;                                                // algunas cajas tienen el código ANTES que el precio                        for (var i=0, e=tFrame.words.length; i<e; ++i) {                            w = tFrame.words[i];                            if (DEBUG) var wc = w.contents;                                                     /* DEBUG */                            if (precio == null && codigo == null && reP.test(w.contents))                                precio = w;                            else if (codigo == null && precio == null && reC.test(w.contents))                                codigo = w;                                                            if (precio != null && reC.test(w.contents)) {                                if (re.test(precio.contents))                                    pairsPC.push({ wCodigo:w, wPrecio:precio, actualizado:false });                                precio = null;                            }                            else if (reP.test(w.contents) && codigo!=null) {                                if (re.test(w.contents))                                    pairsPC.push({ wCodigo:codigo, wPrecio:w, actualizado:false });                                codigo = null;                            }                        }                    });    return pairsPC;}$.writeln("\n==============================\n");var p1 = listarProductoPrecio(app.activeDocument, IKEA.reRD,  IKEA.reCODE);p1.forEach( function(pc) {    $.writeln(pc.wCodigo.contents + '; ' + pc.wPrecio.contents);} );    $.writeln("\n==============================\n");var p2 = listarProductoPrecio(app.activeDocument, IKEA.rePR,  IKEA.reCODE);p1.forEach( function(pc) {    $.writeln(pc.wCodigo.contents + '; ' + pc.wPrecio.contents);} );    